<!-- Generated from 310d701 on 2023-12-19 @ 09:37 with Emacs 27.2 (Org mode 9.4.4) -->
<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta author="System Crafters - David Wilson"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="icon" type="image/png" href="/img/favicon.png"/><link rel="alternative" type="application/rss+xml" title="System Crafters News" href="https://weavermarquez.github.io/rss/news.xml"/><link rel="stylesheet" href="https://weavermarquez.github.io/fonts/iosevka-aile/iosevka-aile.css"/><link rel="stylesheet" href="https://weavermarquez.github.io/fonts/jetbrains-mono/jetbrains-mono.css"/><link rel="stylesheet" href="https://weavermarquez.github.io/css/code.css"/><link rel="stylesheet" href="https://weavermarquez.github.io/css/site.css"/><script defer="defer" data-domain="weavermarquez.github.io" src="https://plausible.io/js/plausible.js"></script><title>Python Development Configuration - System Crafters</title></head><body><header class="site-header"><div class="container"><div class="site-title"><img class="logo" src="https://weavermarquez.github.io/img/sc_logo.png" alt="System Crafters"/></div></div><div class="site-masthead"><div class="container"><nav class="nav"><a class="nav-link" href="/">Home</a> <a class="nav-link" href="/guides/">Guides</a> <a class="nav-link" href="/news/">News</a> <a class="nav-link" href="/community/">Community</a> <a class="nav-link" href="/">Home (2)</a> <a class="nav-link" href="/how-to-help/">How to Help</a></nav></div></div></header><div class="container"><div class="site-post"><h1 class="site-post-title">Python Development Configuration</h1><p class="site-post-meta"></p><div id="content"><p>
<div class="video">  <iframe src="https://www.youtube.com/embed/jPXIP46BnNA" allowfullscreen></iframe></div>
</p>

<p>
Check out the final code <a href="https://github.com/daviwil/emacs-from-scratch/blob/dd9320769f3041ac1edca139496f14abe147d010/Emacs.org#python">here</a>.
</p>

<h2><a id="what-wersquoll-cover" class="anchor" href="#what-wersquoll-cover">¶</a>What we&rsquo;ll cover:</h2><div class="outline-text-2" id="text-orgb768c90">
<ul class="org-ul">
<li>python-mode</li>
<li>lsp-mode</li>
<li>Debugging with dap-mode</li>
<li>Running tests with Projectile</li>
<li>Using virtualenv</li>
</ul>
</div>

<h2><a id="our-example-project" class="anchor" href="#our-example-project">¶</a>Our example project</h2><div class="outline-text-2" id="text-org3af9c09">
<p>
<a href="https://github.com/mikf/gallery-dl">https://github.com/mikf/gallery-dl</a>
</p>
</div>

<h3><a id="installing-requirements" class="anchor" href="#installing-requirements">¶</a>Installing requirements</h3><div class="outline-text-3" id="text-org74e23d1">
<pre>pip install -r requirements.txt</pre>
</div>

<h2><a id="using-codepython-modecode" class="anchor" href="#using-codepython-modecode">¶</a>Using <code>python-mode</code></h2><div class="outline-text-2" id="text-org7214eaf">
<pre>(<span class="org-keyword">use-package</span> <span class="org-constant">python-mode</span>
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:custom</span>
  (python-shell-interpreter <span class="org-string">"python3"</span>))</pre>

<p>
Commands:
</p>
<ul class="org-ul">
<li>Interactive Python shell: <code>M-x run-python</code> (<code>C-c C-p</code> or <code>g z</code> in evil-mode)</li>
<li><code>python-shell-send-file</code> (<code>C-c C-l</code>)</li>
<li><code>python-shell-send-buffer</code> (<code>C-c C-c</code>)</li>
<li><code>python-shell-send-region</code> (<code>C-c C-r</code>)</li>
</ul>
</div>

<h2><a id="setting-up-lsp-mode" class="anchor" href="#setting-up-lsp-mode">¶</a>Setting up lsp-mode</h2><h3><a id="installing-codepylscode" class="anchor" href="#installing-codepylscode">¶</a>Installing <code>pyls</code></h3><div class="outline-text-3" id="text-org1a761ac">
<p>
<a href="https://emacs-lsp.github.io/lsp-mode/page/languages/">https://emacs-lsp.github.io/lsp-mode/page/languages/</a>
</p>

<pre>pip install --user python-language-server[all]</pre>

<p>
Ensure that it&rsquo;s on the <code>PATH</code>!  If not, you may need to add <code>~/.local/bin</code> to <code>PATH</code>
</p>
</div>

<h3><a id="activating-lsp-mode" class="anchor" href="#activating-lsp-mode">¶</a>Activating lsp-mode</h3><div class="outline-text-3" id="text-org6985409">
<p>
We are starting with the <code>lsp-mode</code> configuration from &ldquo;Build Your Own IDE with lsp-mode&rdquo;, check that out for more details on lsp-mode!
</p>

<pre><span class="org-builtin">:hook</span> (python-mode . lsp-deferred))</pre>
</div>

<h3><a id="completion-error" class="anchor" href="#completion-error">¶</a>Completion error!</h3><div class="outline-text-3" id="text-org6a9a99b">
<p>
If you see an error complaining about <code>company-capf</code>, this may be a bug with lsp-mode.
</p>

<p>
As a workaround, run <code>package-reinstall</code> to reinstall <code>lsp-mode</code> and <code>lsp-ui</code> packages and then restart Emacs.
</p>
</div>

<h2><a id="lsp-mode-features" class="anchor" href="#lsp-mode-features">¶</a>lsp-mode features</h2><h3><a id="completions" class="anchor" href="#completions">¶</a>Completions</h3>
<h3><a id="documentation-hover" class="anchor" href="#documentation-hover">¶</a>Documentation hover</h3>
<h3><a id="signature-help" class="anchor" href="#signature-help">¶</a>Signature help</h3>
<h3><a id="linting--diagnostics---codeflycheck-list-errorscode" class="anchor" href="#linting--diagnostics---codeflycheck-list-errorscode">¶</a>Linting / diagnostics - <code>flycheck-list-errors</code></h3>
<h3><a id="code-navigation---codelsp-find-definitioncode-and-codelsp-find-referencescode" class="anchor" href="#code-navigation---codelsp-find-definitioncode-and-codelsp-find-referencescode">¶</a>Code navigation - <code>lsp-find-definition</code> and <code>lsp-find-references</code></h3>
<h3><a id="symbol-renaming---codelsp-renamecode" class="anchor" href="#symbol-renaming---codelsp-renamecode">¶</a>Symbol renaming - <code>lsp-rename</code></h3>
<h3><a id="code-formatting---codelsp-format-buffercode" class="anchor" href="#code-formatting---codelsp-format-buffercode">¶</a>Code formatting - <code>lsp-format-buffer</code></h3>
<h3><a id="symbol-tree---codelsp-treemacs-symbolscode" class="anchor" href="#symbol-tree---codelsp-treemacs-symbolscode">¶</a>Symbol tree - <code>lsp-treemacs-symbols</code></h3>

<h2><a id="running-unit-tests" class="anchor" href="#running-unit-tests">¶</a>Running unit tests</h2><div class="outline-text-2" id="text-orgbcecef0">
<p>
Using pytest:
</p>

<pre>pip install pytest</pre>

<p>
Skip <code>test_results.py</code>, it&rsquo;s slow!
</p>

<p>
Use Projectile&rsquo;s <code>projectile-test-project</code> command:
</p>

<ul class="org-ul">
<li>Set a directory-local variable for <code>projectile-project-test-cmd</code> with <code>add-dir-local-variable</code></li>
<li>Set <code>compilation-read-command</code> to <code>nil</code> to skip asking every time you want to run the test (might be unsafe!)</li>
<li>You can use <code>g r</code> inside of the unit test buffer to rerun the tests or call <code>recompile</code> interactively</li>
</ul>

<p>
Induce a failure!
</p>
</div>

<h2><a id="debugging" class="anchor" href="#debugging">¶</a>Debugging</h2><div class="outline-text-2" id="text-orgdedf93c">
<p>
I recommend watching &ldquo;Emacs IDE - How to Debug Your Code with dap-mode&rdquo; to learn more about the features!
</p>

<p>
Configuration instructions: <a href="https://emacs-lsp.github.io/dap-mode/page/configuration/#python">https://emacs-lsp.github.io/dap-mode/page/configuration/#python</a>
</p>

<p>
However, we will use <code>debugpy</code> (<code>ptvsd</code> is deprecated):
</p>

<pre>pip install debugpy</pre>

<pre>(dap-python-debugger 'debugpy)</pre>

<p>
Run <code>dap-debug</code> and select the pytest configuration.  Fails due to python2!
</p>

<p>
Set <code>dap-python-executable</code> to <code>python3</code>
</p>

<pre>(dap-python-executable <span class="org-string">"python3"</span>)</pre>

<p>
Running the default pytest configuration doesn&rsquo;t launch from the correct path, let&rsquo;s edit the configuration with <code>dap-debug-edit-template</code>:
</p>

<pre>(dap-register-debug-template
  <span class="org-string">"Python :: Run pytest (gallery-dl)"</span>
  (list <span class="org-builtin">:type</span> <span class="org-string">"python"</span>
        <span class="org-builtin">:cwd</span> <span class="org-string">"/home/daviwil/Projects/Code/gallery-dl"</span>
        <span class="org-builtin">:module</span> <span class="org-string">"pytest"</span>
        <span class="org-builtin">:request</span> <span class="org-string">"launch"</span>
              <span class="org-builtin">:debugger</span> 'debugpy
        <span class="org-builtin">:name</span> <span class="org-string">"Python :: Run pytest (gallery-dl)"</span>))</pre>

<p>
However, this still doesn&rsquo;t work correctly from within a file in the project folder.  dap-mode bug?
</p>
</div>

<h2><a id="virtual-environments" class="anchor" href="#virtual-environments">¶</a>Virtual Environments</h2><div class="outline-text-2" id="text-org6e6b356">
<p>
This part is only necessary if you use <code>virtualenv</code> in your Python development workflow!
</p>

<pre>virtualenv env
. env/bin/activate</pre>

<p>
Use <code>pyvenv</code> for setting up the right <code>virtualenv</code> in Emacs:
</p>

<pre>(<span class="org-keyword">use-package</span> <span class="org-constant">pyvenv</span>
  <span class="org-builtin">:config</span>
  (pyvenv-mode 1))</pre>

<p>
Run <code>pyvenv-activate</code> and select the <code>env</code> folder, now <code>lsp-mode</code> and <code>dap-mode</code> will use it!
</p>
</div>
</div></div><div class="list-form center"><div class="list-form-title">Subscribe to the System Crafters Newsletter!</div><form method="POST" action="https://www.simplelists.com/subscribe.php"><input type="hidden" name="format" value="text"/><input type="hidden" name="action" value="subscribe"/><input type="hidden" name="list" value="news@lists.systemcrafters.net"/><div class="list-form-message">Stay up to date with the latest System Crafters news and updates!  Read the <a href="/newsletter/">Newsletter</a> page for more information.</div><div class="row"><div class="column"><div class="row center list-form-label">Name (optional)</div><div class="row"><input type="text" name="name"/></div></div><div class="column"><div class="row center list-form-label">Email Address</div><div class="row"><input type="text" name="email"/></div></div></div><div><input type="submit" value="Subscribe!"/></div></form></div></div><footer class="site-footer"><div class="container"><div class="row"><div class="column"><p><a href="https://weavermarquez.github.io/privacy-policy/">Privacy Policy</a> · <a href="https://weavermarquez.github.io/credits/">Credits</a> · <a href="https://weavermarquez.github.io/rss/">RSS Feeds</a> · <a rel="me" href="https://fosstodon.org/@daviwil">Fediverse</a></p><p>© 2021-2023 System Crafters LLC, and also Weaver Ripped this off</p></div><div class="column align-right"><p><a href="https://github.com/weavermarquez/weavermarquez.github.io"><img src="https://weavermarquez.github.io/img/codeberg.png" style="width: 120px" alt="Contribute on Codeberg"/></a></p></div></div></div></footer></body></html>
