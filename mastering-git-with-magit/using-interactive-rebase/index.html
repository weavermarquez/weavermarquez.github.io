<!-- Generated from 310d701 on 2023-12-19 @ 09:37 with Emacs 27.2 (Org mode 9.4.4) -->
<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta author="System Crafters - David Wilson"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="icon" type="image/png" href="/img/favicon.png"/><link rel="alternative" type="application/rss+xml" title="System Crafters News" href="https://weavermarquez.github.io/rss/news.xml"/><link rel="stylesheet" href="https://weavermarquez.github.io/fonts/iosevka-aile/iosevka-aile.css"/><link rel="stylesheet" href="https://weavermarquez.github.io/fonts/jetbrains-mono/jetbrains-mono.css"/><link rel="stylesheet" href="https://weavermarquez.github.io/css/code.css"/><link rel="stylesheet" href="https://weavermarquez.github.io/css/site.css"/><script defer="defer" data-domain="weavermarquez.github.io" src="https://plausible.io/js/plausible.js"></script><title>Clean Your Commits Like a Git Rebase Expert with Magit - System Crafters</title></head><body><header class="site-header"><div class="container"><div class="site-title"><img class="logo" src="https://weavermarquez.github.io/img/sc_logo.png" alt="System Crafters"/></div></div><div class="site-masthead"><div class="container"><nav class="nav"><a class="nav-link" href="/">Home</a> <a class="nav-link" href="/guides/">Guides</a> <a class="nav-link" href="/news/">News</a> <a class="nav-link" href="/community/">Community</a> <a class="nav-link" href="/">Home (2)</a> <a class="nav-link" href="/how-to-help/">How to Help</a></nav></div></div></header><div class="container"><div class="site-post"><h1 class="site-post-title">Clean Your Commits Like a Git Rebase Expert with Magit</h1><p class="site-post-meta"></p><div id="content"><p>
<div class="video">  <iframe src="https://www.youtube.com/embed/zM7K1y4h6UQ" allowfullscreen></iframe></div>
</p>

<h2><a id="intro" class="anchor" href="#intro">¶</a>Intro</h2><div class="outline-text-2" id="text-org6abd53a">
<p>
Have you ever made a mistake or created sloppy commits when checking in changes to a Git repository?
</p>

<p>
After watching this video, you&rsquo;ll know exactly how to fix those problems and create a clean commit history with <code>git rebase</code> and Magit.
</p>

<div class="cta center">
If you find this guide helpful, please consider supporting System Crafters via the links on the <a href="/how-to-help/#support-my-work">How to Help</a> page!
</div>
</div>

<h2><a id="getting-started" class="anchor" href="#getting-started">¶</a>Getting Started</h2><div class="outline-text-2" id="text-orgbdb0aef">
<p>
Make sure you&rsquo;ve got Magit installed first, check out the first video in the series for more information:
</p>

<ul class="org-ul">
<li><a href="https://youtu.be/_zfvQkJsYwI">An Introduction to the Ultimate Git Interface, Magit!</a></li>
</ul>

<p>
We&rsquo;ll be using the <code>magit-status</code> interface a lot in this video!
</p>

<p>
I&rsquo;ve prepared an example repository that you can use to try the techniques I&rsquo;ll show you in this video, you can clone it here:
</p>

<p>
<a href="https://github.com/SystemCrafters/filet-magit">https://github.com/SystemCrafters/filet-magit</a>
</p>

<p>
To make sure you&rsquo;re in the right branch when you clone this repository, use this command!
</p>

<pre>git clone https://github.com/SystemCrafters/filet-magit -b add-recipes</pre>
</div>

<h2><a id="reviewing-our-commits" class="anchor" href="#reviewing-our-commits">¶</a>Reviewing our commits</h2><div class="outline-text-2" id="text-org4a9f646">
<p>
Let&rsquo;s imagine that we&rsquo;re writing a cookbook package for Emacs.  We&rsquo;ve been working on a feature for adding new cookbook entries and we&rsquo;re just about ready to push those changes to the public repository.
</p>

<p>
But before we do that, let&rsquo;s take a look at our commit history and see if there&rsquo;s any cleanup work we want to do.
</p>

<p>
From a file within the project folder, we can run <code>M-x magit-status</code> to pull up the status buffer.
</p>

<p>
We can take a look at the &ldquo;Recent commits&rdquo; section to review what we&rsquo;ve done so far.
</p>
</div>

<h2><a id="wersquove-got-some-work-to-do" class="anchor" href="#wersquove-got-some-work-to-do">¶</a>We&rsquo;ve got some work to do</h2><div class="outline-text-2" id="text-org3cc0a46">
<p>
We&rsquo;re going to clean up these commits using a feature of Git called &ldquo;interactive rebase&rdquo;.
</p>

<p>
This is a very powerful tool that allows you to edit commit history in a number of ways, so it&rsquo;s very important to know to use it if you work with Git a lot.
</p>

<p>
And as usual, Magit makes it much easier and more efficient to perform rebase operations than it would be on the command line.
</p>

<p>
<b>NOTE:</b> If you have changes to tracked files in your repo you will need to <a href="https://systemcrafters.net/mastering-git-with-magit/everyday-git-workflow/#saving-local-changes-for-later">stash them</a> before proceeding!  (See <a href="https://youtu.be/qPfJoeQCIvA?t=2176">this video</a> for an example).
</p>
</div>

<h2><a id="an-important-tip" class="anchor" href="#an-important-tip">¶</a>An important tip!</h2><div class="outline-text-2" id="text-org5daf8a0">
<p>
Here&rsquo;s something I recommend before doing any rebase operation if you&rsquo;re not that familiar with it yet.
</p>

<p>
Back up your branch before the rebase just to make sure you won&rsquo;t lose access to the original commits!
</p>

<p>
In the <code>magit-status</code> buffer you can press <code>b n</code> to create a new branch.  It will ask you the source branch and the name for the target branch.
</p>

<p>
Now that we have our backup branch, we can always get the original commits back if we make a mistake!
</p>
</div>

<h2><a id="rewording-commits" class="anchor" href="#rewording-commits">¶</a>Rewording commits</h2><div class="outline-text-2" id="text-orgf03a2c5">
<p>
You can reword any commit in your branch&rsquo;s history by performing an interactive rebase using Magit.
</p>

<p>
In the <code>magit-status</code> buffer, put your cursor on the commit you want to reword and press <code>r i</code> (lower-case <code>R</code> then <code>I</code>).  This will bring up a rebase interface which displays the list of commits starting at the selected commit to allow you to pick which operation to take on each of them.
</p>

<p>
For the commit we want to reword, we can put our cursor on its line and press <code>r</code> (lower-case <code>R</code>) and it will be marked as <code>reword</code>.  Press <code>C-c C-c</code> to confirm.
</p>

<p>
You will now be given a commit message editing buffer to fix the wording of the commit.  Make your changes and press <code>C-c C-c</code> to confirm.
</p>
</div>

<h2><a id="you-just-changed-history" class="anchor" href="#you-just-changed-history">¶</a>You just changed history!</h2><div class="outline-text-2" id="text-org5accfa6">
<p>
Keep in mind that editing <b>any</b> commit in the history will cause <b>all following commits</b> to be recreated so they will all have a new commit hash!  This means that you will need to &ldquo;force push&rdquo; your changes to the remote repository if you have already pushed the branch there once before.
</p>
</div>

<h2><a id="reordering-commits" class="anchor" href="#reordering-commits">¶</a>Reordering commits</h2><div class="outline-text-2" id="text-org570903f">
<p>
The commit history you create can be seen as the story of the code&rsquo;s creation.  Sometimes it makes sense for a more recent change to be moved back before other changes to improve the narrative.
</p>

<p>
You can reorder commits easily in the interactive rebase view by placing the cursor on a particular commit and using the following key bindings:
</p>

<ul class="org-ul">
<li><code>M-n</code> / <code>M-j</code> (evil): Move the commit forward in time by one commit</li>
<li><code>M-p</code> / <code>M-k</code> (evil): Move the commit backward in time by one commit</li>
</ul>

<p>
You can reorder multiple commits in one interactive rebase operation!
</p>
</div>

<h2><a id="dealing-with-conflicts-when-moving-commits" class="anchor" href="#dealing-with-conflicts-when-moving-commits">¶</a>Dealing with conflicts when moving commits</h2><div class="outline-text-2" id="text-org11d926a">
<p>
Now let&rsquo;s move another commit, but this time the move is going to create a conflict with the changes in the commit history.
</p>

<p>
We&rsquo;re going to move the commit titled &ldquo;Add function to make a cookbook entry&rdquo; to come just after the initial commit of the package code.
</p>

<p>
Since there&rsquo;s a conflict in the changes of both commits, we need to edit the file to resolve the issues.  Once we&rsquo;ve finished the edit the changes will be automatically staged and we can use <code>r r</code> (two lower-case &rsquo;r&rsquo;) to continue the rebase.
</p>

<p>
We&rsquo;ll be asked to edit and confirm the commit message.  We don&rsquo;t need to add any changes so we can use <code>C-c C-c</code> to complete the commit.
</p>

<p>
We&rsquo;ll also have to deal with another conflict!  Let&rsquo;s add the function back in the next commit and continue from there.
</p>

<p>
<b>NOTE:</b> If the merge is looking too complicated and you want to start over, you can use <code>r a</code> to abort the current rebase!
</p>
</div>

<h2><a id="editing-a-commit" class="anchor" href="#editing-a-commit">¶</a>Editing a commit</h2><div class="outline-text-2" id="text-org95fedc7">
<p>
We&rsquo;ll need to make a tweak to the following commit to restore the use of the new <code>filet-new-recipe</code> in the <code>filet-add-recipe</code> command since we had to remove it when resolving the previous conflicts.
</p>

<p>
Let&rsquo;s start a new interactive rebase and use the <code>edit</code> command on that commit by pressing <code>e</code> with the cursor on that line.
</p>

<p>
We can now go and change the code however we like and then stage those changes to be added to the existing commit.
</p>

<p>
In the <code>magit-status</code> screen press <code>r r</code> to complete the rebase operation.
</p>
</div>

<h2><a id="combining-commits" class="anchor" href="#combining-commits">¶</a>Combining commits</h2><div class="outline-text-2" id="text-org4960b97">
<p>
Now we&rsquo;re going to see how we can combine two commits together.  There are two ways to do this:
</p>

<ul class="org-ul">
<li><code>fixup</code>: Merges only the changes of a commit into the previous commit</li>
<li><code>squash</code>: Merges the changes of a commit into the previous commit and combines their commits messages</li>
</ul>

<p>
Use <code>fixup</code> when you don&rsquo;t care about the commit message and <code>squash</code> when you want to keep it!
</p>

<p>
We&rsquo;ll use <code>fixup</code> to combine the &ldquo;oops&rdquo; commit into the initial package code commit and <code>squash</code> to combine the two documentation commits and merge their messages.
</p>
</div>

<h2><a id="deleting-commits" class="anchor" href="#deleting-commits">¶</a>Deleting commits</h2><div class="outline-text-2" id="text-org1c34b40">
<p>
Sometimes you will make temporary commits that are only useful for debugging purposes or maybe diagnosing a test failure in your CI runs.
</p>

<p>
Before you merge your branch, you will probably want to delete these commits!  Thankfully interactive rebase makes this easy.
</p>

<p>
Start a new interactive rebase at the commit that you want to delete.  We can press the <code>k</code> key to use the &ldquo;drop&rdquo; operation on the temporary commit and then press <code>C-c C-c</code> to confirm and then the commit will be deleted!  (<code>evil-collection</code> users will need to press <code>d</code> instead)
</p>
</div>

<h2><a id="letrsquos-do-it-all-at-once" class="anchor" href="#letrsquos-do-it-all-at-once">¶</a>Let&rsquo;s do it all at once!</h2><div class="outline-text-2" id="text-orgad21cf4">
<p>
Now that we know the whole flow, let&rsquo;s clean up the same commits all in one interactive rebase!
</p>

<p>
Here&rsquo;s the point where the backup branch we created becomes useful.
</p>

<p>
Inside the <code>magit-status</code> screen we can press <code>X</code> (capital letter &rsquo;X&rsquo;) to open the &ldquo;Reset&rdquo; panel.  <code>evil-collection</code> users will need to press <code>O</code> (capital letter &rsquo;O&rsquo;) instead!
</p>

<p>
We will then press <code>h</code> (lower-cased &rsquo;H&rsquo;) to select the &ldquo;Hard&rdquo; option.  In this case, a hard reset will set our working tree back to the state of the source we select.
</p>

<p>
We can now select our <code>add-recipes-backup</code> branch to reset the <code>add-recipes</code> branch back to its previous history!
</p>

<p>
Now let&rsquo;s start the interactive rebase process again and perform all the changes we saw so far in one operation.
</p>
</div>

<h2><a id="thatrsquos-it" class="anchor" href="#thatrsquos-it">¶</a>That&rsquo;s it!</h2><div class="outline-text-2" id="text-org949bc77">
<p>
Let me know in the comments if this video was helpful or if you have any questions and don&rsquo;t forget to click the &ldquo;Like&rdquo; button!
</p>
</div>
</div></div><div class="list-form center"><div class="list-form-title">Subscribe to the System Crafters Newsletter!</div><form method="POST" action="https://www.simplelists.com/subscribe.php"><input type="hidden" name="format" value="text"/><input type="hidden" name="action" value="subscribe"/><input type="hidden" name="list" value="news@lists.systemcrafters.net"/><div class="list-form-message">Stay up to date with the latest System Crafters news and updates!  Read the <a href="/newsletter/">Newsletter</a> page for more information.</div><div class="row"><div class="column"><div class="row center list-form-label">Name (optional)</div><div class="row"><input type="text" name="name"/></div></div><div class="column"><div class="row center list-form-label">Email Address</div><div class="row"><input type="text" name="email"/></div></div></div><div><input type="submit" value="Subscribe!"/></div></form></div></div><footer class="site-footer"><div class="container"><div class="row"><div class="column"><p><a href="https://weavermarquez.github.io/privacy-policy/">Privacy Policy</a> · <a href="https://weavermarquez.github.io/credits/">Credits</a> · <a href="https://weavermarquez.github.io/rss/">RSS Feeds</a> · <a rel="me" href="https://fosstodon.org/@daviwil">Fediverse</a></p><p>© 2021-2023 System Crafters LLC, and also Weaver Ripped this off</p></div><div class="column align-right"><p><a href="https://github.com/weavermarquez/weavermarquez.github.io"><img src="https://weavermarquez.github.io/img/codeberg.png" style="width: 120px" alt="Contribute on Codeberg"/></a></p></div></div></div></footer></body></html>
