<!-- Generated from 310d701 on 2023-12-19 @ 09:37 with Emacs 27.2 (Org mode 9.4.4) -->
<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta author="System Crafters - David Wilson"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="icon" type="image/png" href="/img/favicon.png"/><link rel="alternative" type="application/rss+xml" title="System Crafters News" href="https://weavermarquez.github.io/rss/news.xml"/><link rel="stylesheet" href="https://weavermarquez.github.io/fonts/iosevka-aile/iosevka-aile.css"/><link rel="stylesheet" href="https://weavermarquez.github.io/fonts/jetbrains-mono/jetbrains-mono.css"/><link rel="stylesheet" href="https://weavermarquez.github.io/css/code.css"/><link rel="stylesheet" href="https://weavermarquez.github.io/css/site.css"/><script defer="defer" data-domain="weavermarquez.github.io" src="https://plausible.io/js/plausible.js"></script><title>Using Multiple Emacs Configurations with Chemacs2 - System Crafters</title></head><body><header class="site-header"><div class="container"><div class="site-title"><img class="logo" src="https://weavermarquez.github.io/img/sc_logo.png" alt="System Crafters"/></div></div><div class="site-masthead"><div class="container"><nav class="nav"><a class="nav-link" href="/">Home</a> <a class="nav-link" href="/guides/">Guides</a> <a class="nav-link" href="/news/">News</a> <a class="nav-link" href="/community/">Community</a> <a class="nav-link" href="/">Home (2)</a> <a class="nav-link" href="/how-to-help/">How to Help</a></nav></div></div></header><div class="container"><div class="site-post"><h1 class="site-post-title">Using Multiple Emacs Configurations with Chemacs2</h1><p class="site-post-meta"></p><div id="content"><p>
<a href="https://www.youtube.com/watch?v=hHdM2wVM1PI">Watch the video</a> on YouTube!
</p>

<h2><a id="the-challenge-of-multiple-emacs-configurations" class="anchor" href="#the-challenge-of-multiple-emacs-configurations">¶</a>The challenge of multiple Emacs configurations</h2><div class="outline-text-2" id="text-orgad995d5">
<p>
When you start using Emacs, you typically either build up your own configuration from scratch little by little or adopt one of the many pre-built configurations like Doom Emacs, Spacemacs, or Prelude.
</p>

<p>
But what if you want to experiment with other Emacs configurations or even rebuild your existing config from scratch?
</p>

<p>
Emacs doesn&rsquo;t make it very easy to use multiple Emacs configurations at the same time.  Since there is a well-defined set of locations where Emacs looks for your configuration, your only option to try a new configuration is to move the old one out of the way, move the new one into its place, and restart Emacs.
</p>

<p>
This is a pain to deal with, especially if you want to use multiple configurations at the same time in separate Emacs windows.  I have this problem all the time when running my own configuration and showing off the Emacs From Scratch configuration or someone else&rsquo;s config at the same time!
</p>

<p>
There must be a better way to solve this problem&#x2026;
</p>
</div>

<h2><a id="enter-chemacs2" class="anchor" href="#enter-chemacs2">¶</a>Enter Chemacs2</h2><div class="outline-text-2" id="text-org4f7d15e">
<p>
Chemacs2 is a very small Emacs configuration &ldquo;shim&rdquo; which allows you to set up multiple Emacs configuration profiles so that you can easily switch between them or use them all simultaneously!
</p>

<p>
You can find Chemacs2 on GitHub: <a href="https://github.com/plexus/chemacs2">https://github.com/plexus/chemacs2</a>
</p>

<p>
With Chemacs, you can:
</p>

<ul class="org-ul">
<li>Use both Doom Emacs and Spacemacs simultaneously</li>
<li>Use Doom or Spacemacs while building your own Emacs config from scratch</li>
<li>Try out the Emacs configurations of others very easily</li>
<li>Redesign your Emacs configuration while still using your current one for productivity</li>
<li>Run the same Emacs configuration with different settings for different purposes</li>
</ul>

<p>
It&rsquo;s called Chemacs2 because it&rsquo;s the successor to the original Chemacs, both written by Arne Brasseur.  The main benefit of Chemacs2 over Chemacs is that it supports the new <code>early-init.el</code> config file from Emacs 27 (used by Doom Emacs and others).
</p>

<p>
<b>Windows users</b>, I&rsquo;ve personally verified that Chemacs2 works perfectly there too!  It actually made my personal Emacs configuration easier to manage because I no longer needed to create a symbolic link from my dotfiles repo to the <code>~/.emacs.d</code> path!
</p>
</div>

<h2><a id="setting-it-up" class="anchor" href="#setting-it-up">¶</a>Setting it up</h2><div class="outline-text-2" id="text-org3de759f">
<p>
To set up Chemacs2, you first need to move your existing Emacs configuration out of the way.  Typically your Emacs configuration folder would be in one of two places:
</p>

<ul class="org-ul">
<li><code>$HOME/.emacs.d</code></li>
<li><code>$HOME/.config/emacs</code></li>
</ul>

<p>
Wherever you store your Emacs configuration, you should move it to a new location to make room for the Chemacs config.  I recommend a path like <code>~/.my-emacs</code> or <code>~/.config/my-emacs</code> but it can be whatever path you like!
</p>

<p>
So let&rsquo;s try this now:
</p>

<pre>mv ~/.emacs.d ~/.my-emacs
git clone https://github.com/plexus/chemacs2 ~/.emacs.d</pre>

<p>
This merely sets up the Chemacs configuration shim so that it gets loaded first when you start Emacs.  To load your own configuration with it, you have to create a profile configuration!
</p>
</div>

<h2><a id="managing-your-emacs-profiles" class="anchor" href="#managing-your-emacs-profiles">¶</a>Managing your Emacs profiles</h2><div class="outline-text-2" id="text-org28ff034">
<p>
To tell Chemacs2 where to get your Emacs configuration, create a file in your home directory called <code>~/.emacs-profiles.el</code> and populate it with this line:
</p>

<pre>((<span class="org-string">"myconfig"</span> . ((user-emacs-directory . <span class="org-string">"~/.my-emacs"</span>))))</pre>

<p>
This defines a single Emacs configuration profile called &ldquo;myconfig&rdquo; that configures the <code>user-emacs-directory</code> to point at the <code>~/.my-emacs</code> folder we moved our configuration to before!
</p>

<p>
Now that we have this file in place, let&rsquo;s start Emacs to verify that it works.
</p>
</div>

<h3><a id="adding-a-profile" class="anchor" href="#adding-a-profile">¶</a>Adding a profile</h3><div class="outline-text-3" id="text-orgdab79f4">
<p>
Let&rsquo;s imagine that we wanted to create a new configuration to run alongside the current one.  This is just as easy as adding a new entry to the <code>~/.emacs-profiles.el</code> file:
</p>

<pre>((<span class="org-string">"myconfig"</span> .  ((user-emacs-directory . <span class="org-string">"~/.my-emacs"</span>)))
 (<span class="org-string">"newconfig"</span> . ((user-emacs-directory . <span class="org-string">"~/.my-new-emacs"</span>))))</pre>
</div>

<h3><a id="setting-the-default-profile" class="anchor" href="#setting-the-default-profile">¶</a>Setting the default profile</h3><div class="outline-text-3" id="text-org3f45190">
<p>
When you have multiple profiles set up in this way, you can easily specify which one gets chosen as the default by creating the file <code>~/.emacs-profile</code> and writing the name of the default profile there:
</p>

<pre><span class="org-builtin">echo</span> <span class="org-string">'myconfig'</span> &gt; ~/.emacs-profile</pre>
</div>

<h2><a id="a-real-example" class="anchor" href="#a-real-example">¶</a>A real example!</h2><div class="outline-text-2" id="text-org7845b65">
<p>
Here&rsquo;s an example of using Chemacs2 to use 4 different Emacs configurations:
</p>

<pre>((<span class="org-string">"default"</span>   . ((user-emacs-directory   . <span class="org-string">"~/.dotfiles/.emacs.d"</span>)))
 (<span class="org-string">"doom"</span>      . ((user-emacs-directory   . <span class="org-string">"~/emacs-configs/doom-emacs"</span>)
                 (env . ((<span class="org-string">"DOOMDIR"</span>      . <span class="org-string">"~/.dotfiles/.doom.d"</span>)))))
 (<span class="org-string">"spacemacs"</span> . ((user-emacs-directory   . <span class="org-string">"~/emacs-configs/spacemacs"</span>)
                 (env . ((<span class="org-string">"SPACEMACSDIR"</span> . <span class="org-string">"~/.dotfiles/.spacemacs.d"</span>)))))
 (<span class="org-string">"efs"</span>       . ((user-emacs-directory   . <span class="org-string">"~/emacs-configs/emacs-from-scratch"</span>))))</pre>

<p>
<b>NOTE:</b> The <code>env</code> lines aren&rsquo;t necessary if your Doom or Spacemacs personal config folders are in their default locations!
</p>

<p>
We can now launch Emacs with any of these configurattions <i>at the same time</i> using the following command:
</p>

<pre>emacs --with-profile=profilename</pre>

<p>
So if we wanted to run both Doom and Spacemacs at the same time, we can run:
</p>

<pre>emacs --with-profile=doom &amp;
emacs --with-profile=spacemacs &amp;</pre>

<p>
Also note that we have a a profile named <code>default</code>, this will automatically make that profile the default when you run Emacs without specifying a profile, but you can still override the default by setting up <code>.emacs-profile</code>!
</p>
</div>

<h3><a id="doom-emacs-tip" class="anchor" href="#doom-emacs-tip">¶</a>Doom Emacs Tip</h3><div class="outline-text-3" id="text-org8aa25e7">
<p>
If you originally cloned Doom Emacs to the <code>~/.emacs.d</code> folder and you now had to move it to make room for Chemacs, you might need to do one of two things to ensure that the configuration works!
</p>

<p>
The first thing to try is to run <code>doom sync</code> in the new folder location:
</p>

<pre>$ &lt;new doom location&gt;/bin/doom sync</pre>

<p>
If that doesn&rsquo;t work, you will need to delete the Doom config repo folder and re-clone it into the new location!  This will also require running <code>bin/doom install</code> again.
</p>
</div>

<h2><a id="using-chemacs2-in-your-dotfiles-repository" class="anchor" href="#using-chemacs2-in-your-dotfiles-repository">¶</a>Using Chemacs2 in your dotfiles repository</h2><div class="outline-text-2" id="text-org7b86c99">
<p>
If you have a dotfiles repository (you should!), you can make the Chemacs2 repo a submodule of your dotfiles repository so that you can replicate your multi-Emacs configuration setup on any of your machines.
</p>

<p>
The first step is to initialize the Chemacs2 repository as a submodule wherever you previously kept your <code>.emacs.d</code> folder in your dotfiles repo:
</p>

<pre><span class="org-builtin">cd</span> ~/.dotfiles
git submodule add https://github.com/plexus/chemacs2 .emacs.d</pre>

<p>
If you are using a tool like <a href="https://www.gnu.org/software/stow/">GNU Stow</a> or <a href="https://github.com/daviwil/dotcrafter.el">dotcrafter.el</a> to automatically link files from your dotfiles folder to your home folder, make sure to clone the submodule into the folder that you create your symbolic links from.
</p>

<p>
Keep in mind that you will need to clone your dotfiles repo with the <code>--recursive</code> option from now on:
</p>

<pre>git clone &lt;URL-of-dotfiles-repo&gt; --recursive</pre>

<p>
This will both your dotfiles repository and also any submodule repositories that are needed.
</p>
</div>

<h2><a id="setting-the-codeeln-cachecode-path-correctly" class="anchor" href="#setting-the-codeeln-cachecode-path-correctly">¶</a>Setting the <code>eln-cache</code> path correctly</h2><div class="outline-text-2" id="text-org0c43028">
<p>
One thing I noticed while using Chemacs2 with Emacs 28 and native compilation functionality turned on: the compiler output files were being sent to Chemacs&rsquo; config folder instead of the real folder where my personal configuration lives.  To send those files to the right location, add this line to your configuration:
</p>

<pre>(add-to-list 'comp-eln-load-path (expand-file-name <span class="org-string">"eln-cache/"</span> user-emacs-directory))</pre>

<p>
Doom Emacs seems to have adjusted for this but I can&rsquo;t see it done in Spacemacs, might be needed there too!
</p>

<p>
<b>IMPORTANT NOTE:</b> As of <a href="http://git.savannah.gnu.org/cgit/emacs.git/commit/?id=fbbcbed10ee89e0865bbddc6683ff626ec488ee9">this commit</a> to Emacs 28 <code>master</code> branch, this variable has been renamed to <code>native-comp-eln-load-path</code>!
</p>
</div>

<h2><a id="what-will-you-use-chemacs2-for" class="anchor" href="#what-will-you-use-chemacs2-for">¶</a>What will you use Chemacs2 for?</h2><div class="outline-text-2" id="text-orgad95050">
<p>
Hopefully this gives you some interesing ideas for how you can use Chemacs2 for managing your Emacs configurations!
</p>

<p>
I&rsquo;m curious to hear how you can imagine yourself using it, so please leave a comment on the video and let me know!
</p>
</div>
</div></div><div class="list-form center"><div class="list-form-title">Subscribe to the System Crafters Newsletter!</div><form method="POST" action="https://www.simplelists.com/subscribe.php"><input type="hidden" name="format" value="text"/><input type="hidden" name="action" value="subscribe"/><input type="hidden" name="list" value="news@lists.systemcrafters.net"/><div class="list-form-message">Stay up to date with the latest System Crafters news and updates!  Read the <a href="/newsletter/">Newsletter</a> page for more information.</div><div class="row"><div class="column"><div class="row center list-form-label">Name (optional)</div><div class="row"><input type="text" name="name"/></div></div><div class="column"><div class="row center list-form-label">Email Address</div><div class="row"><input type="text" name="email"/></div></div></div><div><input type="submit" value="Subscribe!"/></div></form></div></div><footer class="site-footer"><div class="container"><div class="row"><div class="column"><p><a href="https://weavermarquez.github.io/privacy-policy/">Privacy Policy</a> · <a href="https://weavermarquez.github.io/credits/">Credits</a> · <a href="https://weavermarquez.github.io/rss/">RSS Feeds</a> · <a rel="me" href="https://fosstodon.org/@daviwil">Fediverse</a></p><p>© 2021-2023 System Crafters LLC, and also Weaver Ripped this off</p></div><div class="column align-right"><p><a href="https://github.com/weavermarquez/weavermarquez.github.io"><img src="https://weavermarquez.github.io/img/codeberg.png" style="width: 120px" alt="Contribute on Codeberg"/></a></p></div></div></div></footer></body></html>
